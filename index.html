<!DOCTYPE html>
<html lang="jp" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>オープンチャット用LIFF</title>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", () => {
      liff
        .init({
          liffId: '2006439463-YBVBvLPr' // LIFF IDをここに入力
        })
        .then(() => {
          // ユーザーがログインしていない場合はログインを促す
          if (!liff.isLoggedIn()) {
            liff.login();
          } else {
            // 権限が必要な場合は確認
            checkPermissions();
          }

          document.getElementById('send').addEventListener('click', () => {
            const messageText = document.getElementById('messageInput').value;
            sendMessage(messageText);
          });
        })
        .catch((err) => {
          console.error('LIFF Initialization failed: ', err);
        });
    });

    function checkPermissions() {
      liff.getProfile().then(profile => {
        console.log('ユーザープロフィールを取得しました:', profile);
      }).catch(error => {
        console.error('プロフィール取得に失敗:', error);
      });
    }

    function sendMessage(message) {
      if (!liff.isInClient()) {
        alert('この機能はLINEアプリ内でのみ利用できます。');
        return;
      }

      // メッセージ送信
      liff.sendMessages([{
        type: 'text',
        text: message
      }])
      .then(() => {
        console.log('メッセージを送信しました:', message);
      })
      .catch((error) => {
        console.error('メッセージ送信エラー:', error);
      });
    }
    </script>
  </head>
  <body>
    <h3>オープンチャットでメッセージを送信</h3>
    <input type="text" id="messageInput" placeholder="メッセージを入力" />
    <button id="send">送信</button>
  </body>
</html>
